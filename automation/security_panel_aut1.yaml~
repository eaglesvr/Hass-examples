###### version 1 - full original #####
########### REMOTES TRIGGERS ##########
  ############ Arm AWAY ########
- alias: Remote Arm Away
  trigger:
    platform: event
    event_type: 'remote_button'
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: alarm_control_panel.ha_alarm
      state: disarmed
    - condition: template
      value_template: "{{trigger.event.data.button =='arma' }}"
    
  action:
    - service: alarm_control_panel.alarm_arm_away
      entity_id: alarm_control_panel.ha_alarm
## send notification
    - service: notify.sec_info_notify  
      data_template:
        message: >
                     Alarm Panel Armed Away by {{trigger.event.data.rem}}


#    - service: notify.file_notify
#      data_template:  
#        message: >
#           alarm panel Armed away by {{trigger.event.data.rem}}

  ############ Arm Home ########
- alias: Remote Arm Home
  trigger:
    platform: event
    event_type: 'remote_button'
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: alarm_control_panel.ha_alarm
      state: disarmed
    - condition: template
      value_template: "{{trigger.event.data.button =='armh' }}"
    
  action:
    - service: alarm_control_panel.alarm_arm_home
      entity_id: alarm_control_panel.ha_alarm

    - service: notify.sec_info_notify  
      data_template:
        message: >
                     Alarm Panel Armed Home by {{trigger.event.data.rem}}


  ############ Disarm by Remote  ########
- alias: Remote Arm Disarm
  trigger:
    platform: event
    event_type: 'remote_button'

  condition:
    condition: and
    conditions:
      - condition: template
        value_template: "{{trigger.event.data.button =='dis' }}"
      - condition: or
        conditions:
          - condition: state
            entity_id: alarm_control_panel.ha_alarm
            state: 'armed_away'
          - condition: state
            entity_id: alarm_control_panel.ha_alarm
            state: 'armed_home'
          - condition: state
            entity_id: alarm_control_panel.ha_alarm
            state: 'triggered'

  action:
    - service:    variable.set_variable 
      data_template:
        variable: alarm_panel_changedby  
        value_template: '{{trigger.event.data.rem}}'

    - service: alarm_control_panel.alarm_disarm
      entity_id: alarm_control_panel.ha_alarm

      ####### DISARM NOTIFICATION #####
- alias: Notify_disarm
  trigger:
    - platform: state
      entity_id: alarm_control_panel.ha_alarm
      to: disarmed
  action:
    - service: notify.sec_info_notify  
      data_template:
        message: >
                  Alarm Panel disarmed by {{states('variable.alarm_panel_changedby')}}


  ############ trigger alarm when Remote SOS pressed ########
- alias: Remote SOS
  trigger:
    platform: event
    event_type: 'remote_button'
  condition:
    - condition: template
      value_template: "{{trigger.event.data.button =='sos' }}"

  action:
    - service:    variable.set_variable 
      data_template:
        variable: alarm_panel_changedby  
        value_template: '{{trigger.event.data.rem}}'

    - service: alarm_control_panel.alarm_trigger
      entity_id: alarm_control_panel.ha_alarm

#    - service: notify.file_notify
#      data:  
#        message: "alarm_panel SOS by remote"

############### Deactivate x10 sirens/ send disarm to ds7000 when host  alarm stops#################
- alias: disarm_ds7000  
  trigger: 
    platform: state
    entity_id: alarm_control_panel.ha_alarm
    from: 'triggered' 
  action: 
    - service: remote.send_command
      entity_id: remote.ds7000
      data: 
        command: 'disarm'
############### trigger alarm  ds7000  - Activate x10 Sirens   #################
- alias: alarm_ds7000  
  trigger: 
    platform: state
    entity_id: alarm_control_panel.ha_alarm
    to: triggered 
    
  action: 
    - service: remote.send_command
      entity_id: remote.ds7000
      data: 
        command: 'panic'
    - service: notify.file_notify
      data:  
        message: "!!! DS7000 set panic"
    - service: notify.gmail_notify
      data:
        title: 'Alarm alert'
        message: 'Alarm triggered'    
    

# ########## arm/disarm Porch& Garage light blink ##############
- alias: sec_arm_light
  trigger: 
    platform: state
    entity_id: alarm_control_panel.ha_alarm
    to: armed_away
  action: 
    service: script.blink_sec_lights
- alias: sec_disarm_light

  trigger: 
    platform: state
    entity_id: alarm_control_panel.ha_alarm
    from: armed_away
    to: disarmed
  action: 
    service: script.blink_sec_lights

################################
###  alarm panel   Alarm Triggered   ###
################################
- alias: Alarm Trigger
  trigger:
    platform: event
    event_type: 'sensor_state'

  condition:
    condition: or
    conditions:
      - condition: and 
        conditions:
        - condition: state
          entity_id: alarm_control_panel.ha_alarm
          state: armed_away
        - condition: template
          value_template: '{{trigger.event.data.zone>0}}'
        - condition: template
          value_template: '{{trigger.event.data.state=="on"}}'
      - condition: and 
        conditions:
        - condition: state
          entity_id: alarm_control_panel.ha_alarm
          state: armed_home
        - condition: template
          value_template: '{{trigger.event.data.zone<2}}'
        - condition: template
          value_template: '{{trigger.event.data.state=="on"}}'
  action:
    - service: alarm_control_panel.alarm_trigger
      entity_id: alarm_control_panel.ha_alarm

    - service: notify.sec_alerts_ios
      data_template: 
        message: >
         Alarm triggered by {{trigger.event.data.snr}}
        title: "HA_Alarm"
        data: 
          push:
            badge: 5
    - service: notify.gmail_notify
      data_template: 
        message: >
         Alarm triggered by {{trigger.event.data.snr}}
        title: "HA_Alarm"

    - service: notify.file_notify
      data_template:  
        message: >
          alarm triggered {{trigger.event.data.snr }}

    - service: noitfy.sec_alarm_notify
      data_template:  
        message: >
          alarm triggered {{trigger.event.data.snr }}

- alias: Door Chime
  trigger:
    platform: state
    to: 'on'
    entity_id:
    - variable.secsnr_patio_door
    - variable.secsnr_front_door
    - variable.secsnr_gar_door
    - variable.secsnr_test_snr
    - variable.x10snr_gar_gate
  action:
    - service: shell_command.door_chime
#    - service: switch.turn_on
#      entity_id: switch.door_snr_chime
